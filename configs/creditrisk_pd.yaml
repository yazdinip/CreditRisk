paths:
  model_dir: models
  model_filename: creditrisk_pd_model.joblib
  metrics_file: reports/metrics.json
  reports_dir: reports
  feature_store_path: data/processed/feature_store.parquet
  train_set_path: data/processed/train.parquet
  test_set_path: data/processed/test.parquet

data:
  raw_path: data/raw/application_train.csv
  target_column: TARGET
  drop_columns:
    - SK_ID_CURR
  sample_rows:
  stratify: true
  entity_id_column: SK_ID_CURR
  bureau_path: data/raw/bureau.csv
  bureau_balance_path: data/raw/bureau_balance.csv
  previous_application_path: data/raw/previous_application.csv
  installments_payments_path: data/raw/installments_payments.csv
  credit_card_balance_path: data/raw/credit_card_balance.csv
  pos_cash_balance_path: data/raw/POS_CASH_balance.csv

features:
  categorical:
  numerical:
  drop_columns: []
  add_missing_count: true
  missing_threshold: 0.4
  categorical_drop:
    - NAME_TYPE_SUITE
    - OCCUPATION_TYPE
    - ORGANIZATION_TYPE
  add_days_employed_anomaly: true
  days_employed_anomaly_value: 365243
  missing_indicator_columns:
    - EXT_SOURCE_1
    - EXT_SOURCE_2
    - EXT_SOURCE_3
    - OWN_CAR_AGE
  selected_columns:
    - CNT_CHILDREN
    - AMT_INCOME_TOTAL
    - AMT_CREDIT
    - AMT_ANNUITY
    - AMT_GOODS_PRICE
    - REGION_POPULATION_RELATIVE
    - DAYS_BIRTH
    - DAYS_EMPLOYED
    - DAYS_EMPLOYED_ANOM
    - DAYS_EMPLOYED_REPLACED
    - AGE_YEARS
    - EMPLOYED_YEARS
    - EMPLOYMENT_YEARS_TO_AGE
    - DAYS_REGISTRATION
    - DAYS_ID_PUBLISH
    - FLAG_MOBIL
    - FLAG_EMP_PHONE
    - FLAG_WORK_PHONE
    - FLAG_CONT_MOBILE
    - FLAG_PHONE
    - FLAG_EMAIL
    - CNT_FAM_MEMBERS
    - REGION_RATING_CLIENT
    - REGION_RATING_CLIENT_W_CITY
    - HOUR_APPR_PROCESS_START
    - REG_REGION_NOT_LIVE_REGION
    - REG_REGION_NOT_WORK_REGION
    - LIVE_REGION_NOT_WORK_REGION
    - REG_CITY_NOT_LIVE_CITY
    - REG_CITY_NOT_WORK_CITY
    - LIVE_CITY_NOT_WORK_CITY
    - EXT_SOURCE_2
    - EXT_SOURCE_3
    - EXT_SOURCE_1_IS_MISSING
    - EXT_SOURCE_2_IS_MISSING
    - EXT_SOURCE_3_IS_MISSING
    - TOT_MISSING_COUNT
    - OBS_30_CNT_SOCIAL_CIRCLE
    - DEF_30_CNT_SOCIAL_CIRCLE
    - OBS_60_CNT_SOCIAL_CIRCLE
    - DEF_60_CNT_SOCIAL_CIRCLE
    - DAYS_LAST_PHONE_CHANGE
    - FLAG_DOCUMENT_2
    - FLAG_DOCUMENT_3
    - FLAG_DOCUMENT_4
    - FLAG_DOCUMENT_5
    - FLAG_DOCUMENT_6
    - FLAG_DOCUMENT_7
    - FLAG_DOCUMENT_8
    - FLAG_DOCUMENT_9
    - FLAG_DOCUMENT_10
    - FLAG_DOCUMENT_11
    - FLAG_DOCUMENT_12
    - FLAG_DOCUMENT_13
    - FLAG_DOCUMENT_14
    - FLAG_DOCUMENT_15
    - FLAG_DOCUMENT_16
    - FLAG_DOCUMENT_17
    - FLAG_DOCUMENT_18
    - FLAG_DOCUMENT_19
    - FLAG_DOCUMENT_20
    - FLAG_DOCUMENT_21
    - AMT_REQ_CREDIT_BUREAU_HOUR
    - AMT_REQ_CREDIT_BUREAU_DAY
    - AMT_REQ_CREDIT_BUREAU_WEEK
    - AMT_REQ_CREDIT_BUREAU_MON
    - AMT_REQ_CREDIT_BUREAU_QRT
    - AMT_REQ_CREDIT_BUREAU_YEAR
    - missing_count
    - PAYMENT_RATE
    - CREDIT_TO_INCOME
    - ANNUITY_TO_INCOME
    - GOODS_TO_CREDIT
    - INCOME_PER_PERSON
    - CHILDREN_RATIO
    - DOC_COUNT
    - CONTACT_COUNT
    - ADDR_MISMATCH_SUM
    - OWN_CAR_AGE_IS_MISSING
    - NAME_CONTRACT_TYPE_Cash loans
    - NAME_CONTRACT_TYPE_Revolving loans
    - CODE_GENDER_F
    - CODE_GENDER_M
    - CODE_GENDER_XNA
    - FLAG_OWN_CAR_N
    - FLAG_OWN_CAR_Y
    - FLAG_OWN_REALTY_N
    - FLAG_OWN_REALTY_Y
    - NAME_INCOME_TYPE_Businessman
    - NAME_INCOME_TYPE_Commercial associate
    - NAME_INCOME_TYPE_Maternity leave
    - NAME_INCOME_TYPE_Pensioner
    - NAME_INCOME_TYPE_State servant
    - NAME_INCOME_TYPE_Student
    - NAME_INCOME_TYPE_Unemployed
    - NAME_INCOME_TYPE_Working
    - NAME_EDUCATION_TYPE_Academic degree
    - NAME_EDUCATION_TYPE_Higher education
    - NAME_EDUCATION_TYPE_Incomplete higher
    - NAME_EDUCATION_TYPE_Lower secondary
    - NAME_EDUCATION_TYPE_Secondary / secondary special
    - NAME_FAMILY_STATUS_Civil marriage
    - NAME_FAMILY_STATUS_Married
    - NAME_FAMILY_STATUS_Separated
    - NAME_FAMILY_STATUS_Single / not married
    - NAME_FAMILY_STATUS_Unknown
    - NAME_FAMILY_STATUS_Widow
    - NAME_HOUSING_TYPE_Co-op apartment
    - NAME_HOUSING_TYPE_House / apartment
    - NAME_HOUSING_TYPE_Municipal apartment
    - NAME_HOUSING_TYPE_Office apartment
    - NAME_HOUSING_TYPE_Rented apartment
    - NAME_HOUSING_TYPE_With parents
    - WEEKDAY_APPR_PROCESS_START_FRIDAY
    - WEEKDAY_APPR_PROCESS_START_MONDAY
    - WEEKDAY_APPR_PROCESS_START_SATURDAY
    - WEEKDAY_APPR_PROCESS_START_SUNDAY
    - WEEKDAY_APPR_PROCESS_START_THURSDAY
    - WEEKDAY_APPR_PROCESS_START_TUESDAY
    - WEEKDAY_APPR_PROCESS_START_WEDNESDAY
    - BUREAU_N_ACTIVE
    - BUREAU_N_CLOSED
    - BUREAU_LAST_CREDIT_DAYS
    - BUREAU_LAST_UPDATE_DAYS
    - BUREAU_TOTAL_DEBT
    - BUREAU_TOTAL_CREDIT
    - BUREAU_LIMIT_SUM
    - BUREAU_UTIL_MEAN
    - BUREAU_OVERDUE_SUM
    - BUREAU_MAX_OVERDUE
    - BUREAU_PROLONG_SUM
    - BB_DELINQ_SHARE_MEAN
    - BB_WORST_STATUS_MAX
    - BB_MONTHS_SINCE_LAST_DELINQ_MIN
    - PREV_TOTAL
    - PREV_APPROVED
    - PREV_REFUSED
    - PREV_CANCELLED
    - PREV_UNUSED
    - PREV_APP_CREDIT_RATIO_MEAN
    - PREV_DOWNPAYMENT_RATE_MEAN
    - PREV_CNT_PAYMENT_MEAN
    - PREV_LAST_DECISION_DAYS
    - PREV_EARLIEST_DECISION_DAYS
    - PREV_APPROVAL_RATE
    - PREV_REFUSED_RATE
    - INSTAL_PAYMENT_RATIO_MEAN
    - INSTAL_PAYMENT_RATIO_STD
    - INSTAL_LATE_MEAN
    - INSTAL_LATE_MAX
    - INSTAL_LATE_SHARE
    - INSTAL_SEVERE_LATE_SHARE
    - CC_UTIL_MEAN
    - CC_UTIL_MAX
    - CC_MINPAY_COVERAGE_MEAN
    - CC_MINPAY_MET_SHARE
    - CC_DPD_ANY_SHARE
    - CC_DPD_MAX
    - CC_CASH_RATIO_MEAN
    - POS_DPD_ANY_SHARE
    - POS_DPD_MAX
    - POS_MONTHS_SINCE_LAST_ACTIVE

training:
  test_size: 0.2
  random_state: 42
  class_weight: balanced
  n_jobs: -1
  use_gpu: false
  early_stopping_rounds:
  use_smote: true
  smote_sampling_strategy: 0.2
  downsample_majority: true

model:
  type: xgboost
  params:
    n_estimators: 500
    learning_rate: 0.05
    max_depth: 5
    subsample: 0.8
    colsample_bytree: 0.8
    reg_lambda: 1.0
    reg_alpha: 0.0

tracking:
  enabled: true
  tracking_uri: mlruns
  experiment_name: creditrisk_pd
  run_name: creditrisk_pd_xgboost
  tags:
    project: credit-risk
    stage: pd-model

inference:
  decision_threshold: 0.5
  governance_tags:
    underwriting_program: creditrisk_pd
    portfolio: home_credit
    channel: api
  mlflow_inference_experiment: creditrisk_pd_inference

registry:
  enabled: true
  model_name: CreditRiskPD
  stage_on_register: Staging
  promote_on_metric: roc_auc
  promote_min_value: 0.78
  archive_existing_on_promote: true

validation:
  enabled: true
  enforce_raw_contracts: true
  enforce_feature_store_contract: true
  enforce_split_contracts: true
  enforce_model_io_contracts: true

testing:
  enabled: true
  min_metrics:
    roc_auc: 0.75
    normalized_gini: 0.50
    precision: 0.25
    recall: 0.40
  evaluation_artifacts:
    - confusion_matrix.png
    - confusion_matrix.json
    - roc_curve.png
    - precision_recall_curve.png
    - calibration_curve.png
  require_mlflow: true
  mlflow_metric_tolerance: 0.0005
  report_filename: post_training_validation.json

monitoring:
  enabled: true
  drift_enabled: true
  backend: evidently
  reference_sample_size: 50000
  current_sample_size: null
  feature_list: []
  max_features: 50
  stat_test: ks
  stat_test_threshold: 0.05
  production_current_path: data/production/current.parquet
  production_reference_path: data/processed/train.parquet
  cloudwatch_namespace: CreditRisk/Monitoring
  cloudwatch_metric_name: CreditRiskPD
  auto_retrain: false
  retrain_drift_threshold: 0.3
  retrain_command: dvc repro validate_model

ingestion:
  enabled: true
  fail_on_missing: true
  sources:
    - name: application_train
      type: kaggle_competition
      decompress: true
      checksum: 793a017f41fbac1dc28176b26dbab30e
      output_path: data/raw/application_train.csv
      options:
        competition: home-credit-default-risk
        file: application_train.csv
    - name: bureau
      type: kaggle_competition
      decompress: true
      checksum: ec0f59a16e7071de66b83217b23bb390
      output_path: data/raw/bureau.csv
      options:
        competition: home-credit-default-risk
        file: bureau.csv
    - name: bureau_balance
      type: kaggle_competition
      decompress: true
      checksum: 5e815ea6eb338752724bcf46da13c602
      output_path: data/raw/bureau_balance.csv
      options:
        competition: home-credit-default-risk
        file: bureau_balance.csv
    - name: previous_application
      type: kaggle_competition
      decompress: true
      checksum: bd1eb5f08a4700414db1742e5cc0f9fa
      output_path: data/raw/previous_application.csv
      options:
        competition: home-credit-default-risk
        file: previous_application.csv
    - name: installments_payments
      type: kaggle_competition
      decompress: true
      checksum: 4e9751972d02c376f0e75edbf6c9d07d
      output_path: data/raw/installments_payments.csv
      options:
        competition: home-credit-default-risk
        file: installments_payments.csv
    - name: credit_card_balance
      type: kaggle_competition
      decompress: true
      checksum: ff83bfc2285d218802c6dff749bc5efc
      output_path: data/raw/credit_card_balance.csv
      options:
        competition: home-credit-default-risk
        file: credit_card_balance.csv
    - name: pos_cash_balance
      type: kaggle_competition
      decompress: true
      checksum: cb8e5cc3885d1e53753955ffde317b44
      output_path: data/raw/POS_CASH_balance.csv
      options:
        competition: home-credit-default-risk
        file: POS_CASH_balance.csv
